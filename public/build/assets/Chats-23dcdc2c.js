import{N as $,I as b,r as N,q as T,O as I,u as A,o as u,g as h,a as d,d as a,w as m,F as w,H as j,b as e,z as y,h as S,t as p,L as D,f as _,s as R,D as U,n as F,G as z}from"./app-7cfb65c9.js";import{_ as B}from"./ClientLayout-89c8cb02.js";import{O as V}from"./OrdersCard-1b29cb49.js";import{_ as L}from"./OrdersTitle-d433f634.js";import{_ as P}from"./Modal-21b05b72.js";import{_ as q}from"./PrimaryButton-3d24646e.js";import{_ as H}from"./SecondaryButton-7c1f2913.js";import{u as G}from"./useFornatedTime-bf881812.js";import{u as W}from"./useFlash-0de93865.js";import"./NavLink-c5717994.js";import"./ApplicationLogo-7b42fb0a.js";import"./_plugin-vue_export-helper-c27b6911.js";import"./FlashMessage-f45d1e5c.js";import"./FooterGlobal-409d70a9.js";let{flash:g}=W();const J=$("chatroom",{state:()=>({chats:{},recipients:[],messages:[],chat:[],chatRecipient:{},chatMessages:{},chatUser:{},users:{}}),actions:{initialize(l,s,o={}){this.chats=l,this.recipients=this.recipients.concat(s),this.messages=o},loadChats(){try{b.get(route("chats.index"))}catch{g("OOPS!! Something went wrong!","The connection was terminated by an internal server error.","error")}},async sendChatMessage(l=null,s={},o){try{const t=await b.post(route("chats.store"),{message:s.message,recipientId:s.recipientId,chatId:l,userId:o});t.status!==200?(console.log("Server Error! ",t.status),console.log("Error Details! ",t.data),g("Server Error!",`Unable to process new Chat request. Server responded with error code ${t.status}`,"error")):(this.chats=t.data.chats,this.recipients=t.data.recipients,this.users=t.data.users,g("Sent!","Message sent successfully.","success"))}catch(t){console.log("Connection Error! ",t),g("OOPS!! Something went wrong!","The connection was terminated by an internal server error.","error")}},async loadChat(l){try{const s=await b.post(route("messages.show",l));s.status===200?(console.log("Send Chat message success: ",s.data),this.chatMessages=s.data.messages,this.chat=s.data.chat,this.chatRecipient=s.data.recipients,this.chatUser=s.data.user):(console.log("Server Error! ",s.status),console.log("Error Details! ",s.data),g("Server Error!","Server could not load the messages.","error"))}catch(s){console.log("Connection Error! ",s),g("Connection Error!","Something is not right! We could not establish a connection with the server. Try again later or report this case to site admin!","error")}},loadAllMessages(){console.log("All messages not loaded.")}},getters:{numberOfChats:()=>globalThis.chats.length}}),K={class:"text-gray-900 rounded"},Q={class:"m-3 ml-4 p-4 lg:pt-6"},X={class:"p-3"},Y=e("div",{class:"pb-3 text-center underline text-indigo-500 col-span-3"},[e("h3",null,"Chats")],-1),Z={class:"space-y-3"},ee={class:"flex justify-between md:max-w-2/3 lg:w-full mx-auto border-b border-indigo-400 bg-purple-200 rounded-lg p-2 lg:px-6"},se={class:"text-base font-serif"},te={class:"text-sm"},ae={class:"text-slate-600"},oe={class:"text-sm"},re={class:"text-lime-600"},ne={class:"p-2 flex place-items-center"},ie=["onClick"],le={class:"mt-4 py-4 px-5 scroll-auto max-h-screen overflow-y-auto mb-10 font-serif"},ce={class:"pb-6 rounded"},de=e("h2",{class:"text-lg font-bold text-gray-900"}," Chat Messages. ",-1),ue={key:0,class:"flex flex-col place-items-start py-2"},he={class:"bg-green-200 px-4 pb-3 rounded-xl max-w-xs"},me={class:"text-lime-700 font-semibold underline text-end text-sm"},pe={class:"text-xs text-gray-700"},_e={key:1,class:"flex flex-col place-items-end py-2"},ge={class:"bg-amber-200 px-2.5 pb-2 rounded-xl max-w-xs"},fe={class:"py-1 flex justify-between text-lime-700 underline text-xs"},xe={class:"mt-6 pb-8"},ve=e("label",{for:"instructions",class:"block mb-2 text-sm font-semibold"}," New Message: ",-1),be={class:"mt-6 flex justify-end"},De={__name:"Chats",props:{messages:Object,chats:Object,recipients:Array,users:Object},setup(l){const s=l;let o=J(),{formatTime:t}=G();const f=N(!1);let k=o.chatMessages;const v=T(()=>z().props.value.auth.user);I(()=>{o.initialize(s.chats,s.recipients,s.messages)});let x=A({message:"",userId:v.value.id,recipientId:1,draft:null,isRead:null,recipientDepartment:null,title:null,description:null});function M(c){o.sendChatMessage(c,x.data(),v.value.id)}function O(c){o.loadChat(c),f.value=!0}function C(c){let n="User";for(let i of o.recipients)i.id===c&&(n=i.name);return n}function E(){f.value=!1}return(c,n)=>(u(),h(w,null,[d(a(j),{title:"Chats"}),d(B,null,{header:m(()=>[d(L,{title:"Chats",about:"Recent conversations."},null,8,["about"])]),default:m(()=>[e("section",null,[d(V,null,{default:m(()=>[e("section",K,[e("div",Q,[e("button",{onClick:n[0]||(n[0]=y(i=>f.value=!0,["prevent"])),class:"mx-auto p-2 px-4 bg-lime-200 text-purple-900 hover:underline border border-slate-700 rounded hover:bg-lime-300 hover:text-purple-800 active:bg-slate-400 active:ring-purple-900 transition ease-in-out hover:duration-500 active:duration-500"}," New Chat ")]),e("div",X,[Y,e("div",Z,[(u(!0),h(w,null,S(a(o).chats,i=>(u(),h("div",ee,[e("div",se,[e("p",te,[e("span",ae,p(C(i.recipient_id)==="kanothe"?"Admin":C(i.recipient_id)),1)]),e("p",oe,[e("span",re,p(a(t)(i.created_at)),1)])]),e("div",ne,[e("button",{onClick:y(r=>O(i.id),["prevent"]),class:"text-sky-400 hover:text-sky-500 underline underline-offset-4 mx-2"},"Open",8,ie),d(a(D),{href:"/",class:"text-red-600 hover:text-red-900 underline mx-2"},{default:m(()=>[_("Remove")]),_:1})]),d(P,{show:f.value,onClose:E},{default:m(()=>[e("div",le,[e("div",ce,[de,(u(!0),h(w,null,S(a(k),r=>(u(),h("div",null,[r.user_id!==a(v).id?(u(),h("div",ue,[e("div",he,[e("p",me,[_(p(c.chatStarter.role==="A"?"Admin":c.chatStarter.name)+" - ",1),e("span",pe,p(a(t)(r.created_at)),1)]),_(" "+p(r.message),1)])])):(u(),h("div",_e,[e("div",ge,[e("p",fe,p(a(t)(r.created_at)),1),_(" "+p(r.message),1)])]))]))),256))]),e("div",xe,[ve,R(e("textarea",{id:"message",name:"message",rows:"3",ref_for:!0,ref:"instructionsInput","onUpdate:modelValue":n[1]||(n[1]=r=>a(x).message=r),placeholder:"Type a message.",class:"block p-2.5 w-full text-xs md:text-sm shadow-sm shadow-purple-300 bg-white rounded-lg border border-gray-200 focus:ring-blue-300 focus:border-blue-300"},`
                                            `,512),[[U,a(x).message]])]),e("div",be,[d(H,{onClick:n[2]||(n[2]=r=>f.value=!1)},{default:m(()=>[_(" Cancel ")]),_:1}),d(q,{onClick:r=>M(i.id),class:F(["ml-4",{"opacity-25":a(x).processing}]),disabled:a(x).processing},{default:m(()=>[_(" Send Message ")]),_:2},1032,["onClick","class","disabled"])])])]),_:2},1032,["show"])]))),256))])])])]),_:1})])]),_:1})],64))}};export{De as default};
